const elHead=document.getElementById("calenderHeader"),elDay=document.getElementById("calendarWeekDay"),elCal=document.getElementById("calendarContent"),elYear=document.getElementById("year"),elMonth=document.getElementById("month"),elLang=document.getElementById("lang"),elModal=document.getElementById("dayInfoModal"),elBody=document.getElementById("modalBody"),elOverlay=document.getElementById("modalOverlay"),elClose=document.getElementById("modalClose");var SY=1577917828/4320000,LM=1577917828/53433336,MO=1954168.050623,SCR="";const FullEnglishMonths=["January","February","March","April","May","June","July","August","September","October","November","December"],FullWeekDays=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],FullMmWeekDays=["တနင်္ဂနွေ","တနင်္လာ","အင်္ဂါ","ဗုဒ္ဓဟူး","ကြာသာပတေး","သောကြာ","စနေ"],ShortWeekDays=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],MyanmarYearNames=["ပုဿနှစ်","မာခနှစ်","ဖ္လကိုန်နှစ်","စယ်နှစ်","ပိသျက်နှစ်","စိဿနှစ်","အာသတ်နှစ်","သရဝန်နှစ်","ဘဒြနှစ်","အာသိန်နှစ်","ကြတိုက်နှစ်","မြိက္ကသိုဝ်နှစ်"],FullMyanmarMonths=["ပထမ ဝါဆို","တန်ခူး","ကဆုန်","နယုန်","ဝါဆို","ဝါခေါင်","တော်သလင်း","သီတင်းကျွတ်","တန်ဆောင်မုန်း","နတ်တော်","ပြာသို","တပိုတွဲ","တပေါင်း","နှောင်းတန်ခူး","နှောင်းကဆုန်"],ShortMyanmarMonths=["ပ ဆို","ခူး","ဆုန်","ယုန်","ဆို","ခေါင်","လင်း","ကျွတ်","မုန်း","တော်","သို","တွဲ","ပေါင်း","နှောင်း ခူး","နှောင်း ဆုန်"],FullMoonStatus=["လဆန်း","လပြည့်","လဆုတ်","လကွယ်"],ShortMoonStatus=["ဆန်း","ပြည့်","ဆုတ်","ကွယ်"],FullSabbaths=["","ဥပုသ်","အဖိတ်"],ShortSabbaths=["","ပုသ်","ဖိတ်"],FullThingyanHolidays=["သင်္ကြန်အကြိုနေ့","သင်္ကြန်အကျနေ့","သင်္ကြန်အကြတ်နေ့","သင်္ကြန်အတက်နေ့","မြန်မာနှစ်ဆန်း ၁ ရက်နေ့"],ShortThingyanHolidays=["အကြို","အကျ","အကြတ်","အတက်","နှစ်ဆန်း"],FullEnHolidays=["နိုင်ငံတကာနှစ်သစ်ကူးနေ့","လွတ်လပ်ရေးနေ့","ပြည်ထောင်စုနေ့","တောင်သူလယ်သမားနေ့","တော်လှန်ရေးနေ့","အလုပ်သမားနေ့","အာဇာနည်နေ့","ခရစ္စမတ်နေ့"],FullMmHolidays=["ကဆုန်လပြည့် (ဗုဒ္ဓနေ့)","ဝါဆိုလပြည့်","သီတင်းကျွတ်လပြည့်","တန်ဆောင်တိုင်","အမျိုးသားနေ့","ကရင်နှစ်သစ်ကူး","တပေါင်းလပြည့်"];function SetToday(){const e=new Date();elYear.value=e.getFullYear(),elMonth.value=e.getMonth(),LoadWeekDayUI(),LoadDate()};function ChangeMonth(e){let t=Number(elMonth.value),n=Number(elYear.value);t+=e,t<0&&(t+=12,n--),t>11&&(t-=12,n++),elMonth.value=t,elYear.value=n,LoadDate()}function LoadWeekDayUI(){let e=SCR=='S'?ShortWeekDays:FullWeekDays,t='';for(let i=0;i<7;i++)t+=`<div class="day-name d${i}">${e[i]}</div>`;elDay.innerHTML=t}function LoadDate(){let e=parseInt(elYear.value),t=parseInt(elMonth.value),n=new Date,a=n.getDate(),l=n.getMonth(),r=n.getFullYear(),c=new Date(e,t,1).getDay(),s=new Date(e,t+1,0).getDate();LoadTitle(e,t,s);let d=1,o='<div class="week-row">';for(let n=0;n<c;n++)o+='<div class="day"></div>';while(d<=s){let n='';d===a&&t===l&&e===r&&(n=' today');const i=w2j(e,t+1,d),y=j2m(i),m=cal_sabbath(y.md,y.mm,y.myt),h=y.mm==4&&y.myt>0,v=cal_mp(y.md,y.mm,y.myt),p=cal_mf(y.md),g=mm_holiday(y.my,y.mm,y.md,v),M=en_holiday(e,t,d),u=thingyan_holiday(i,y.myt,y.my,y.mm,v);(g>-1||M>-1||u>-1)&&(n+=' holiday');let w='';SCR=='S'?o+=`<div class="day${n}" onclick="showDayInfo(${d},${i})"><div class="row"><span class="en-date">${d}</span><span class="sabbath-day">${ShortSabbaths[m]}</span></div><div class="row center">${h?'ဒုတိယ':''} ${ShortMyanmarMonths[y.mm]}</div><div class="row center">${ShortMoonStatus[v]}</div><div class="row center">${mmNumber(p)}</div></div>`:(g>-1&&(w+=`<div class="row center helight">${FullMmHolidays[g]}</div>`),M>-1&&(w+=`<div class="row center helight">${FullEnHolidays[M]}</div>`),u>-1&&(w+=`<div class="row center helight">${FullThingyanHolidays[u]}</div>`),o+=`<div class="day${n}" onclick="showDayInfo(${d}, ${i})"><div class="row"><span class="en-date">${d}</span><span class="sabbath-day">${FullSabbaths[m]}</span></div><div class="row center">${h?'ဒုတိယ':''} ${FullMyanmarMonths[y.mm]}</div><div class="row center">${FullMoonStatus[v]}</div><div class="row center">${mmNumber(p)}</div>${w}</div>`),d++,(c+d-1)%7===0&&(o+='</div><div class="week-row">')}while((c+d-1)%7!==0)o+='<div class="day"></div>',d++;o+='</div>',elCal.innerHTML=o}function LoadTitle(e,t,n){const a=w2j(e,t+1,1),l=w2j(e,t+1,n),r=j2m(a),c=j2m(l),s=cal_sy(r.my,r.mm,r.md),i=cal_sy(c.my,c.mm,c.md);let o='';s!==i&&(o=`<div>သာသာနာနှစ် ${mmNumber(s)} - ${mmNumber(i)}</div>`),o=`<div>သာသာနာနှစ် - ${mmNumber(s)}</div>`;let d='';r.my!==c.my&&(d=`<div>မြန်မာသက္ကရာဇ် ${mmNumber(r.my)} - ${mmNumber(c.my)}</div>`),d=`<div>မြန်မာသက္ကရာဇ် - ${mmNumber(r.my)}</div>`;const m=(r.mm==4&&r.myt>0?'ဒုတိယ':''),f=(c.mm==4&&c.myt>0?'ဒုတိယ':''),p=`<div>${m} ${FullMyanmarMonths[r.mm]} - ${f} ${FullMyanmarMonths[c.mm]}</div>`;elHead.innerHTML=o+d+p}function cal_sy(y,m,d){return y+((m==1||(m==2&&d<16))?1181:1182);}function w2j(y,m,d,h=12,n=0,s=0){let a=(14-m)/12|0;return d+((153*(m+12*a-3)+2)/5|0)+365*(y+4800-a)+((y+4800-a)/4|0)-((y+4800-a)/100|0)+((y+4800-a)/400|0)-32045+t2d(h,n,s);}function t2d(h,n,s){return (h-12)/24+n/1440+s/86400;}function j2m(j){j=j+.5|0;let y=(j-MO)/SY|0,o=cal_my(y),d=j-o.tg1+1,b=o.myt>>1,c=(o.myt+1)**-1|0,l=354+(1-c)*30+b,m=(d-1)/l|0;d-=m*l;let a=(d+423)/512|0,mm=((d-b*a+c*a*30+29.26)/29.544)|0,e=(mm+12)/16|0,f=(mm+11)/16|0,md=d-((29.544*mm-29.26)|0)-b*e+c*f*30;return{myt:o.myt,my:y,mm:mm+f*3-e*4+12*m,md};}function cal_mp(d,m,t){return ((d+1)/16|0)+(d/16|0)+(d/cal_mml(m,t)|0);}function cal_mf(d){return d-15*(d/16|0);}function cal_sabbath(d,m,t){let l=cal_mml(m,t);return [8,15,23,l].includes(d)?1:[7,14,22,l-1].includes(d)?2:0;}function cal_my(y) {let d=0,w=0,y1,y2=cal_watat(y),t=y2.watat;do d++,y1=cal_watat(y-d);while(!y1.watat&&d<3);if(t){let n=(y2.fm-y1.fm)%354;t=(n/31|0)+1,w=n==30||n==31?0:1;}return {myt:t,tg1:y1.fm+354*d-102,fm:t?y2.fm:y1.fm+354*d,werr:w};}function cal_watat(y){let c=GetMyConst(y),T=(SY/12-LM)*(12-c.NM),e=(SY*(y+3739))%LM;if(e<T)e+=LM;let f=(SY*y+MO-e+4.5*LM+c.WO)|0,w=c.EI>=2?e>=LM-(SY/12-LM)*c.NM?1:0:(((y*7+2)%19+19)%19/12)|0;return {fm:f,watat:w^c.EW};}function GetMyConst(my){var EI,WO,NM,EW=0,i,fme,wte;if(my>=1312){EI=3;WO=-.5;NM=8;fme=[[1377,1]];wte=[1344,1345]}else if(my>=1217){EI=2;WO=-1;NM=4;fme=[[1234,1],[1261,-1]];wte=[1263,1264]}else if(my>=1100){EI=1.3;WO=-.85;NM=-1;fme=[[1120,1],[1126,-1],[1150,1],[1172,-1],[1207,1]];wte=[1201,1202]}else if(my>=798){EI=1.2;WO=-1.1;NM=-1;fme=[[813,-1],[849,-1],[851,-1],[854,-1],[927,-1],[933,-1],[936,-1],[938,-1],[949,-1],[952,-1],[963,-1],[968,-1],[1039,-1]];wte=[]}else{EI=1.1;WO=-1.1;NM=-1;fme=[[205,1],[246,1],[471,1],[572,-1],[651,1],[653,2],[656,1],[672,1],[729,1],[767,-1]];wte=[]}i=bSearch2(my,fme);if(i>=0)WO+=fme[i][1];i=bSearch1(my,wte);if(i>=0)EW=1;return{EI:EI,WO:WO,NM:NM,EW:EW}}function cal_mml(mm,myt){var mml=30-mm%2;if(mm==3)mml+=Math.floor(myt/2);return mml}function bSearch1(k,A){var i=0,l=0,u=A.length-1;while(u>=l){i=Math.floor((l+u)/2);if(A[i]>k)u=i-1;else if(A[i]<k)l=i+1;else return i}return-1}function bSearch2(k,A){var i=0,l=0,u=A.length-1;while(u>=l){i=Math.floor((l+u)/2);if(A[i][0]>k)u=i-1;else if(A[i][0]<k)l=i+1;else return i}return-1}function mmNumber(n){const d=["၀","၁","၂","၃","၄","၅","၆","၇","၈","၉"];return String(n).split("").map(i=>d[i]).join("")}function openModal(){elModal.classList.add("d-block");elOverlay.classList.add("d-block")}function closeModal(){elModal.classList.remove("d-block");elOverlay.classList.remove("d-block")}function showDayInfo(en_date,jd){jd=Math.round(jd);let year=parseInt(elYear.value),month=parseInt(elMonth.value),str=`<section style="margin-bottom:5px; padding-left:10px;"><div class="row">${year} ${FullEnglishMonths[month]} ${en_date}</div>`;str+=`<div class="row">${FullWeekDays[(jd+1)%7]}</div></section>`;let{myt,my,mm,md}=j2m(jd),mp=cal_mp(md,mm,myt),wd=(jd+2)%7,sasanarYear=cal_sy(my,mm,md);str+=`<section style="margin-bottom:5px; padding-left:10px;"><div class="row">သာသာနာနှစ် ${mmNumber(sasanarYear)} ခု</div>`;str+=`<div class="row">မြန်မာသက္ကရာဇ် ${mmNumber(my)} ခု</div>`;str+=`<div class="row">${MyanmarYearNames[my%12]}</div>`;let sb=cal_sabbath(md,mm,myt),mPre=mm==4&&myt>0,mf=cal_mf(md);str+=`<div class="row">${mPre?"ဒုတိယ":""} ${FullMyanmarMonths[mm]} ${FullMoonStatus[mp]} ${mmNumber(mf)} ရက်</div>`;str+=`<div class="row">${FullMmWeekDays[(jd+1)%7]}နေ့</div></section>`;str+=`<section style="margin-bottom:5px; padding-left:10px;"><div class="row helight">${FullSabbaths[sb]}</div></section>`;let h1=mm_holiday(my,mm,md,mp),h2=en_holiday(year,month,en_date),h3=thingyan_holiday(jd,myt,my,mm,mp);str+=`<section style="margin-bottom:5px; padding-left:10px;">`;if(h1>-1)str+=`<div class="row helight">${FullMmHolidays[h1]}</div>`;if(h2>-1)str+=`<div class="row helight">${FullEnHolidays[h2]}</div>`;if(h3>-1)str+=`<div class="row helight">${FullThingyanHolidays[h3]}</div>`;str+=`</section>`;elBody.innerHTML=str;openModal()}function updateWindowSize(){const width=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;let _SCR=width<768?"S":"M";if(SCR!==_SCR){SCR=_SCR;LoadWeekDayUI();LoadDate()}}function mm_holiday(my,mm,md,mp){return(mm==2&&mp==1)?0:(mm==4&&mp==1)?1:(mm==7&&mp==1)?2:(mm==8&&mp==1)?3:(my>=1282&&mm==8&&md==25)?4:(mm==10&&md==1)?5:(mm==12&&mp==1)?6:-1}function en_holiday(y,m,d){return(y>=2018&&y<=2021&&m==0&&d==1)?0:(y>=1948&&m==0&&d==4)?1:(y>=1947&&m==1&&d==12)?2:(y>=1958&&m==2&&d==2)?3:(y>=1945&&m==2&&d==27)?4:(y>=1923&&m==4&&d==1)?5:(y>=1947&&m==6&&d==19)?6:(y>=1752&&m==11&&d==25)?7:-1}function thingyan_holiday(jdn,myt,my,mm,mp){jdn=Math.round(jdn);let mmt=Math.floor(mm/13),akn,atn,ja,jk;ja=SY*(my+mmt)+MO;jk=my>=1312?ja-2.169918982:ja-2.1675;akn=Math.round(jk);atn=Math.round(ja);return(my+mmt)>=1100?(jdn==(akn-1))?0:(jdn==akn)?1:(jdn>akn&&jdn<atn)?2:(jdn==atn)?3:-1:(jdn==(atn+1))?4:-1}window.addEventListener('resize', updateWindowSize);elClose.addEventListener('click', closeModal);elOverlay.addEventListener('click', closeModal);